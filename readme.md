# 代码结构说明


[实验完整说明请点此处（已实现所有指令](./lab说明/设计模式_lab1.md)

## 整体架构概述
该项目是一个基于Go语言实现的简易编辑器系统，采用了多种设计模式（观察者模式、备忘录模式等），主要功能包括文件编辑、状态保存与恢复、日志记录等。项目采用模块化设计，各组件职责清晰，通过接口实现解耦。

## 关键模块介绍

### 1. 公共模块（common）
- **位置**：`lab1/common/common.go`
- **核心功能**：定义系统通用接口和数据结构
- **主要内容**：
    - `Editor`接口：定义编辑器必须实现的方法（文件操作、状态管理、日志控制等）
    - `WorkspaceEvent`结构：描述工作区事件的标准化格式
    - `Observer`接口：观察者模式的核心接口，定义事件更新方法
    - `WorkSpaceApi`接口：工作区对外提供的事件通知能力

### 2. 工作区模块（workspace）
- **位置**：`lab1/workspace/workspace.go`
- **核心功能**：管理编辑器实例和工作区状态
- **主要内容**：
    - 实现观察者模式：支持观察者注册、移除和事件通知
    - 实现备忘录模式：负责工作区状态的保存（`SaveState`）与恢复（`RestoreState`）
    - 文件操作：加载（`LoadFile`）、保存（`SaveFile`）、关闭（`CloseFile`）等核心操作
    - 维护打开的编辑器集合和当前活动编辑器

### 3. 编辑器模块（editor）
- **位置**：`lab1/editor/`
- **核心功能**：提供具体的文件编辑能力
- **主要内容**：
    - `EditorFactory`工厂函数：根据文件类型创建对应的编辑器实例
    - 文本编辑器实现：提供内容展示（`Show`）、追加（`Append`）、插入（`Insert`）、删除（`Delete`）等编辑功能
    - 日志状态管理：通过文件首行`# log`标记判断初始日志状态
    - 支持撤销（`Undo`）、重做（`Redo`）操作

### 4. 日志模块（log）
- **位置**：`lab1/log/log.go`
- **核心功能**：实现编辑操作的日志记录
- **主要内容**：
    - 实现`Observer`接口：订阅工作区事件并记录日志
    - 日志文件管理：为每个编辑文件创建对应的日志文件（`.文件名.log`）
    - 日志格式：包含时间戳、操作命令等信息
    - 会话管理：记录会话开始时间，支持日志句柄的统一关闭

### 5. 存储模块（storage）
- **位置**：`lab1/storage/storage.go`
- **核心功能**：提供工作区状态的持久化存储
- **主要内容**：
    - 实现备忘录的加载（`LoadMemento`）功能
    - 支持JSON格式的序列化与反序列化

### 6. 主程序（main）
- **位置**：`lab1/main.go`
- **核心功能**：系统入口，协调各模块工作
- **主要内容**：
    - 初始化各组件（工作区、日志模块、存储等）
    - 建立模块间依赖关系（如日志模块订阅工作区事件）
    - 提供用户交互界面：解析并处理用户命令

## 模块依赖关系
```
main
├── workspace（依赖common、editor、storage）
│   ├── common（接口定义）
│   └── editor（编辑器实例）
├── editor（依赖common、workspace）
│   └── common（接口实现）
├── log（依赖common）
│   └── common（Observer接口实现）
└── storage（依赖workspace）
    └── workspace（Memento结构）
```

- **依赖方向**：高层模块（main）依赖低层模块，通过接口实现反向依赖隔离
- **事件流**：编辑器操作 → 工作区事件 → 日志模块（观察者）接收并记录

## 可扩展之处

1. **编辑器类型扩展**
    - 通过`EditorFactory`可轻松添加新类型编辑器（如XML编辑器、Markdown编辑器）
    - 只需实现`common.Editor`接口并在工厂函数中添加类型判断

2. **日志功能增强**
    - 可扩展日志格式（如添加用户信息、详细操作内容）
    - 支持日志分级（INFO/WARN/ERROR）和日志轮转
    - 增加日志导出功能

3. **命令系统扩展**
    - 在`main.go`的`handleCommand`函数中可添加新命令（如查找替换、格式转换）
    - 可实现命令历史记录和批量执行功能

4. **存储方式扩展**
    - 目前仅支持本地文件存储，可扩展为数据库存储或云存储
    - 实现增量保存功能，减少IO操作

5. **用户界面扩展**
    - 目前为命令行界面，可基于现有模块开发GUI界面
    - 增加快捷键支持和菜单系统

6. **协作功能扩展**
    - 基于现有事件系统，可添加网络同步功能实现多人协作编辑
    - 增加冲突检测与解决机制

7. **版本控制集成**
    - 可集成Git等版本控制系统，实现更强大的历史记录管理
    - 在现有Undo/Redo基础上增加分支管理功能